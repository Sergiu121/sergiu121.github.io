<!DOCTYPE html>
<html  lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1"><meta name="viewport" content="width=device-width, initial-scale=1" />

      <title>6. Aprofundarea folosirii fișierelor Makefile</title>
    
      <link rel="stylesheet" href="../../_static/pygments.css">
      <link rel="stylesheet" href="../../_static/theme.css">
      <link rel="stylesheet" href="../../_static/romnn_sphinx_press_theme.css">
          <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
          <link rel="stylesheet" href="../../_static/css/theme.css " type="text/css" />
      
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>

      <!-- sphinx script_files -->
        <script src="../../_static/documentation_options.js?v=5929fcd5"></script>
        <script src="../../_static/doctools.js?v=888ff710"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../../_static/my_actions.js?v=1451d81f"></script>

      
      <script src="../../_static/theme-vendors.js"></script>
      <script src="../../_static/theme.js" defer></script>
    
  <link rel="index" title="Index" href="../../genindex.html" />
  <link rel="search" title="Search" href="../../search.html" />
  <link rel="next" title="7. Introducere în Git și GitHub" href="git-intro.html" />
  <link rel="prev" title="5. Introducere în utilitarul Make și fișiere Makefile" href="make-simple-automation.html" />
    <link href="../../_static/my_theme.css" rel="stylesheet" type="text/css">

  </head>

  <body>
    <div id="app" class="theme-container" :class="pageClasses"><navbar @toggle-sidebar="toggleSidebar">
  <div class="home-link-container">
      <router-link to="../../index.html" class="home-link">
      
        <span class="site-name">USO Lab Book</span>
    </router-link>
  </div>

  <div class="links">
    <navlinks class="can-hide">

  
    <div class="nav-item">
      <a href="../../index.html#uso-lab-book"
         class="nav-link ">
         Acomodarea în Linux
      </a>
    </div>
  
    <div class="nav-item">
      <a href="../../index.html#uso-lab-book"
         class="nav-link ">
         Lucrul cu fișiere
      </a>
    </div>
  
    <div class="nav-item">
      <a href="../../index.html#uso-lab-book"
         class="nav-link  router-link-active">
         Dezvoltarea aplicațiilor
      </a>
    </div>
  
    <div class="nav-item">
      <a href="../../index.html#uso-lab-book"
         class="nav-link ">
         Conectarea la Internet
      </a>
    </div>
  
    <div class="nav-item">
      <a href="../../index.html#uso-lab-book"
         class="nav-link ">
         Instalarea și utilizarea aplicațiilor
      </a>
    </div>
  
    <div class="nav-item">
      <a href="../../index.html#uso-lab-book"
         class="nav-link ">
         Îmbunătățirea lucrului în linia de comandă
      </a>
    </div>
  
    <div class="nav-item">
      <a href="../../index.html#uso-lab-book"
         class="nav-link ">
         Planificarea sarcinilor administrative
      </a>
    </div>
  



  
    <div class="nav-item">
      <a href="https://github.com/Sergiu121/uso-lab-book"
        class="nav-link external">
          Github <outboundlink/>
      </a>
    </div>
  

    </navlinks>
  </div>
</navbar>

      
      <div class="sidebar-mask" @click="toggleSidebar(false)">
      </div>
        <sidebar @toggle-sidebar="toggleSidebar">
          
          <navlinks>
            

  
    <div class="nav-item">
      <a href="../../index.html#uso-lab-book"
         class="nav-link ">
         Acomodarea în Linux
      </a>
    </div>
  
    <div class="nav-item">
      <a href="../../index.html#uso-lab-book"
         class="nav-link ">
         Lucrul cu fișiere
      </a>
    </div>
  
    <div class="nav-item">
      <a href="../../index.html#uso-lab-book"
         class="nav-link  router-link-active">
         Dezvoltarea aplicațiilor
      </a>
    </div>
  
    <div class="nav-item">
      <a href="../../index.html#uso-lab-book"
         class="nav-link ">
         Conectarea la Internet
      </a>
    </div>
  
    <div class="nav-item">
      <a href="../../index.html#uso-lab-book"
         class="nav-link ">
         Instalarea și utilizarea aplicațiilor
      </a>
    </div>
  
    <div class="nav-item">
      <a href="../../index.html#uso-lab-book"
         class="nav-link ">
         Îmbunătățirea lucrului în linia de comandă
      </a>
    </div>
  
    <div class="nav-item">
      <a href="../../index.html#uso-lab-book"
         class="nav-link ">
         Planificarea sarcinilor administrative
      </a>
    </div>
  



  
    <div class="nav-item">
      <a href="https://github.com/Sergiu121/uso-lab-book"
        class="nav-link external">
          Github <outboundlink/>
      </a>
    </div>
  

            
          </navlinks><div id="searchbox" class="searchbox" role="search">
  <div class="caption"><span class="caption-text">Search</span>
    <div class="searchformwrapper">
      <form autocomplete="off" class="search" action="../../search.html" method="get">
        <input type="text" name="q" autocomplete="off" />
        <input type="submit" value="Go" />
        <input type="hidden" name="check_keywords" value="yes" />
        <input type="hidden" name="area" value="default" />
      </form>
    </div>
  </div>
</div><div class="sidebar-links" role="navigation" aria-label="main navigation">
  
    <div class="sidebar-group">
      <p class="caption">
        <span class="caption-text"><a href="../../index.html#uso-lab-book">Acomodarea în Linux</a></span>
      </p>
      <ul class="">
        
          <li class="toctree-l1 "><a href="../basic/apps.html" class="reference internal ">Pornirea și oprirea aplicațiilor</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="../basic/browser.html" class="reference internal ">Folosirea eficientă a browserului web</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="../basic/terminal.html" class="reference internal ">Lucrul în terminal</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="../basic/workspace.html" class="reference internal ">Lucrul cu workspace-uri</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="../basic/cheatsheet.html" class="reference internal ">Sumar - Cheatsheet</a>

            
          </li>

        
      </ul>
    </div>
  
    <div class="sidebar-group">
      <p class="caption">
        <span class="caption-text"><a href="../../index.html#uso-lab-book">Lucrul cu fișiere</a></span>
      </p>
      <ul class="">
        
          <li class="toctree-l1 "><a href="../files/paths.html" class="reference internal ">Căi în ierarhia de fișiere</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="../files/files.html" class="reference internal ">Interacțiunea cu fișiere în linia de comandă</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="../files/file_editor.html" class="reference internal ">Editor de text</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="../files/io_redirection.html" class="reference internal ">Redirectări</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="../files/archive.html" class="reference internal ">Arhive</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="../files/file_system.html" class="reference internal ">Extra - Sistemul de fișiere</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="../files/cheatsheet.html" class="reference internal ">Sumar - Cheatsheet</a>

            
          </li>

        
      </ul>
    </div>
  
    <div class="sidebar-group">
      <p class="caption">
        <span class="caption-text"><a href="../../index.html#uso-lab-book">Dezvoltarea aplicațiilor</a></span>
      </p>
      <ul class="current">
        
          <li class="toctree-l1 "><a href="intro.html" class="reference internal ">Introducere</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="make-intro.html" class="reference internal ">Compilarea unui fișier cod sursă C</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="make-multiple.html" class="reference internal ">Compilarea unui program din fișiere multiple</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="make-lib.html" class="reference internal ">Legarea executabilelor folosind biblioteci externe</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="make-simple-automation.html" class="reference internal ">Introducere în utilitarul Make și fișiere Makefile</a>

            
          </li>

        
          <li class="toctree-l1 current"><a href="#" class="reference internal current">Aprofundarea folosirii fișierelor Makefile</a>

            
              <ul>
                
                  <li class="toctree-l2"><a href="#variabile" class="reference internal">Variabile</a></li>
                
                  <li class="toctree-l2"><a href="#targetul-phony" class="reference internal">Targetul .PHONY</a></li>
                
              </ul>
            
          </li>

        
          <li class="toctree-l1 "><a href="git-intro.html" class="reference internal ">Introducere în Git și GitHub</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="git-first-commits.html" class="reference internal ">Primele commituri</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="git-branches.html" class="reference internal ">Lucrul pe branch-uri</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="git-first-pull-request.html" class="reference internal ">Crearea unui Pull Request (PR) pe GitHub</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="extra.html" class="reference internal ">Exercițîi suplimentare</a>

            
          </li>

        
      </ul>
    </div>
  
    <div class="sidebar-group">
      <p class="caption">
        <span class="caption-text"><a href="../../index.html#uso-lab-book">Conectarea la Internet</a></span>
      </p>
      <ul class="">
        
          <li class="toctree-l1 "><a href="../net/browser.html" class="reference internal ">Folosirea eficientă a browserului</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="../net/connection.html" class="reference internal ">Conectarea la rețea și la Internet</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="../net/services.html" class="reference internal ">Servicii și clienți de rețea</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="../net/extra.html" class="reference internal ">Funcţionalităţi suplimentare de reţelistică</a>

            
          </li>

        
      </ul>
    </div>
  
    <div class="sidebar-group">
      <p class="caption">
        <span class="caption-text"><a href="../../index.html#uso-lab-book">Instalarea și utilizarea aplicațiilor</a></span>
      </p>
      <ul class="">
        
          <li class="toctree-l1 "><a href="../app-install/start.html" class="reference internal ">Pornirea și oprirea aplicațiilor</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="../app-install/run.html" class="reference internal ">Rularea aplicațiilor</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="../app-install/config.html" class="reference internal ">Configurarea rulării aplicațiilor</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="../app-install/summary1.html" class="reference internal ">Exerciții: Pornirea, rularea și configurarea aplicațiilor</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="../app-install/show-config.html" class="reference internal ">Vizualizarea configurației sistemului</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="../app-install/install.html" class="reference internal ">Instalarea și dezinstalarea aplicațiilor</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="../app-install/install-non-standard.html" class="reference internal ">Alternative la instalarea și dezinstalarea aplicațiilor</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="../app-install/show.html" class="reference internal ">Investigarea aplicațiilor instalate</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="../app-install/summary2.html" class="reference internal ">Exerciții: Instalarea și gestiunea aplicațiilor</a>

            
          </li>

        
      </ul>
    </div>
  
    <div class="sidebar-group">
      <p class="caption">
        <span class="caption-text"><a href="../../index.html#uso-lab-book">Îmbunătățirea lucrului în linia de comandă</a></span>
      </p>
      <ul class="">
        
          <li class="toctree-l1 "><a href="../improve-cli/improve-terminal.html" class="reference internal ">Îmbunătățirea lucrului în linia de comandă</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="../improve-cli/inspect-fs.html" class="reference internal ">Inspectarea sistemului de fișiere</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="../improve-cli/inspect-sys.html" class="reference internal ">Inspectarea sistemului</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="../improve-cli/inspect-files.html" class="reference internal ">Inspectarea fișierelor</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="../improve-cli/process-files.html" class="reference internal ">Prelucrarea fișierelor</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="../improve-cli/improve-shell.html" class="reference internal ">O înțelegere mai bună a shell-ului</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="../improve-cli/term-multiplexing.html" class="reference internal ">Multiplexarea terminalului</a>

            
          </li>

        
      </ul>
    </div>
  
    <div class="sidebar-group">
      <p class="caption">
        <span class="caption-text"><a href="../../index.html#uso-lab-book">Planificarea sarcinilor administrative</a></span>
      </p>
      <ul class="">
        
          <li class="toctree-l1 "><a href="../task-admin/workstation.html" class="reference internal ">Folosirea unui workstation remote</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="../task-admin/remote.html" class="reference internal ">Conectarea la workstation</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="../task-admin/usage.html" class="reference internal ">Folosirea stației la distanță</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="../task-admin/storage.html" class="reference internal ">Gestionarea spațiului de stocare partajat</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="../task-admin/services-config.html" class="reference internal ">Configurarea și administrarea serviciilor</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="../task-admin/services-install.html" class="reference internal ">Instalarea aplicațiilor (serviciilor) folosind Docker</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="../task-admin/monitor.html" class="reference internal ">Monitorizarea sistemului</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="../task-admin/cron.html" class="reference internal ">Programarea rulării acțiunilor</a>

            
          </li>

        
      </ul>
    </div>
  
</div>
        </sidebar>

      <page>
          <div class="body-header" role="navigation" aria-label="navigation">
  
  <ul class="breadcrumbs">
    <li><a href="../../index.html">Docs</a> &raquo;</li>
    
    <li><span class="section-number">6. </span>Aprofundarea folosirii fișierelor Makefile</li>
  </ul>
  

  <ul class="page-nav">
  <li class="prev">
    <a href="make-simple-automation.html"
       title="previous chapter">← <span class="section-number">5. </span>Introducere în utilitarul Make și fișiere Makefile</a>
  </li>
  <li class="next">
    <a href="git-intro.html"
       title="next chapter"><span class="section-number">7. </span>Introducere în Git și GitHub →</a>
  </li>
</ul>
  
</div>
<hr>
          <div class="content" role="main">
            
  <section id="aprofundarea-folosirii-fisierelor-makefile">
<h1><span class="section-number">6. </span>Aprofundarea folosirii fișierelor Makefile<a class="headerlink" href="#aprofundarea-folosirii-fisierelor-makefile" title="Link to this heading">¶</a></h1>
<section id="variabile">
<h2><span class="section-number">6.1. </span>Variabile<a class="headerlink" href="#variabile" title="Link to this heading">¶</a></h2>
<p>Nu cred că variabilele au nevoie de o introducere. Au fost cu noi de la începutul carierei noastre de programatori și sunt aici să ne facă viața mai ușoară, fiind placeholdere pentru valorile noastre.
În Makefile-uri, variabilele acționează identic cu variabilele din bash, adică fiind doar înlocuiri textuale.</p>
<p>Astfel, putem simplifica un Makefile de tipul:</p>
<blockquote id="app-dev-phony-makefile">
<div><p>all: make_exec</p>
<dl class="simple">
<dt>make_exec: Fisier_cu_nume_foarte_foarte_foarte_foarte_lung.o</dt><dd><p>gcc -o exec Fisier_cu_nume_foarte_foarte_foarte_foarte_lung.c</p>
</dd>
<dt>TODO.o: Fisier_cu_nume_foarte_foarte_foarte_foarte_lung.c</dt><dd><p>gcc -c Fisier_cu_nume_foarte_foarte_foarte_foarte_lung.c</p>
</dd>
<dt>clean:</dt><dd><p>rm exec
rm <a href="#id1"><span class="problematic" id="id2">*</span></a>.o</p>
</dd>
</dl>
</div></blockquote>
<p>cu ceva mai simplu:</p>
<blockquote id="id3">
<div><p>NAME=Fisier_cu_nume_foarte_foarte_foarte_foarte_lung</p>
<p>all: make_exec</p>
<dl class="simple">
<dt>make_exec: $(NAME).o</dt><dd><p>gcc -o exec $(NAME).c</p>
</dd>
<dt>TODO.o: $(NAME).c</dt><dd><p>gcc -c $(NAME).c</p>
</dd>
<dt>clean:</dt><dd><p>rm exec
rm <a href="#id4"><span class="problematic" id="id5">*</span></a>.o</p>
</dd>
</dl>
</div></blockquote>
<p>Sintaxa: PLACEHOLDER=text</p>
<p>Inlocuirea este doar la nivel textual, deci textul poate fi reprezentat de orice:</p>
<ul class="simple">
<li><p>FLAGS=-Wall -Wextra -C99 -g</p></li>
<li><p>COMPILER=gcc</p></li>
<li><p>EXECUTABLE_NAME=exec</p></li>
<li><p>FISIER=TODO</p></li>
<li><p>Etc…</p></li>
</ul>
<p><em>Se recomandă numirea variabilelor acestea cu litere mari.</em></p>
<p>Pentru utilizare, ca și în bash, se folosește semnul $ urmat de paranteze rotunde în jurul numelui variabilei, astfel: $(NUME_VARIABILA).</p>
<p>Exemplu:</p>
<blockquote id="id6">
<div><dl class="simple">
<dt>all: $(FISIER).c</dt><dd><p>$(COMPILER) -o $(EXECUTABLE_NAME) $(FISIER).c $(FLAGS)</p>
</dd>
</dl>
</div></blockquote>
</section>
<section id="targetul-phony">
<h2><span class="section-number">6.2. </span>Targetul <cite>.PHONY</cite><a class="headerlink" href="#targetul-phony" title="Link to this heading">¶</a></h2>
<p>În mod implicit, targets-urile Makefile sunt „targets de fișiere” - sunt utilizate pentru a construi fișiere din alte fișiere.
Make presupune că ținta sa este <em>un fișier</em> și acest lucru face ca scrierea Makefiles să fie relativ ușoară.</p>
<p>Exemplu:
.. _app_dev_phony_makefile:</p>
<blockquote>
<div><p>all: make_exec</p>
<dl class="simple">
<dt>make_exec: TODO.o</dt><dd><p>gcc -o exec TODO.c</p>
</dd>
<dt>TODO.o: TODO.c</dt><dd><p>gcc -c TODO.c</p>
</dd>
<dt>clean:</dt><dd><p>rm exec
rm <a href="#id7"><span class="problematic" id="id8">*</span></a>.o</p>
</dd>
</dl>
</div></blockquote>
<p id="app-dev-understand-using-phony-makefile">Dacă scrieți o regulă a cărui cod nu va crea fișierul țintă, codul va fi executat de fiecare dată când ținta este chemată. În cazul nostru, targetul clean nu are un fișier de care depinde (asemenea make_exec sau TODO.o), așa că va rula de fiecare dată când va fi chemat prin ‘make clean’.
De aici reiese o problema a Makefile-urilor: ele nu vor chema niciodată un target care este ‘up-to-date’. Ce înseamnă asta?
Pentru un fișier .c la care nu am adus modificări, acesta rămâne ‘up-to-date’, deci nu va fi recompilat, ceea ce este un lucru bun, fiindcă nu este nevoie să recompilam un fișier asupra căruia nu am adus modificări.
Dar, dacă în folderul curent avem un fișier cu numele target-ului nostru, de exemplu un fișier cu numele ‘clean’, ce se va întâmpla?
Atâta timp când fișierul nu este modificat, acesta va rămâne ‘up-to-date’, iar comanda ‘make clean’ nu va mai funcționa, pentru că va identifica fișierul care nu a fost modificat cu numele ‘clean’ în loc de a executa codul dorit.</p>
<p>Soluția se află în target-ul <strong>PHONY</strong>; Acesta specifică faptul că target-urile introduse după acesta <strong>nu</strong> au o legătură directă cu fișierele.</p>
<section id="adaugarea-targetului-phony">
<h3><span class="section-number">6.2.1. </span>Adăugarea targetului <cite>.PHONY</cite><a class="headerlink" href="#adaugarea-targetului-phony" title="Link to this heading">¶</a></h3>
<p>Observăm cum suntem protejați de recompilarea fișierului cu extensia .c datorită targetului TODO.o care afișează mesajul “make: ‘TODO.o’ is up to date.” în cazul în care chemăm ‘make TODO.O’ în timp ce fișierul există.</p>
<p>Exemplu:</p>
<blockquote id="id9">
<div><p>all: make_exec</p>
<dl class="simple">
<dt>make_exec: TODO.o</dt><dd><p>gcc -o exec TODO.c</p>
</dd>
<dt>TODO.o: TODO.c</dt><dd><p>gcc -c TODO.c</p>
</dd>
<dt>clean:</dt><dd><p>rm exec
rm <a href="#id10"><span class="problematic" id="id11">*</span></a>.o</p>
</dd>
</dl>
<p>.PHONY: clean</p>
</div></blockquote>
<p>Acum, adăugând ultima linie în Makefile, target-ul clean nu va mai fi considerat un fișier (datorita lui PHONY), astfel că putem avea un fișier numit ‘clean’ și tot putem rula comanda ‘make clean’.</p>
<p>Observație legată de targetul PHONY: Dacă adăugăm, separat cu spațiu, alte nume pe lângă ‘clean’ de mai sus, și aceste target-uri vor fi considerate non-fișiere.
Atenție, PHONY trebuie folosit cu grijă! Dacă am adaugă pe lângă ‘clean’ și targetul ‘TODO.o’, am pierde protecția împotriva recompilarii nenecesare și deci am anula utilitatea Makefile-ului.</p>
</section>
</section>
</section>


          </div>
          <div class="page-nav">
            <div class="inner"><ul class="page-nav">
  <li class="prev">
    <a href="make-simple-automation.html"
       title="previous chapter">← <span class="section-number">5. </span>Introducere în utilitarul Make și fișiere Makefile</a>
  </li>
  <li class="next">
    <a href="git-intro.html"
       title="next chapter"><span class="section-number">7. </span>Introducere în Git și GitHub →</a>
  </li>
</ul><div class="footer" role="contentinfo">
      &#169; Copyright 2020, USO Team.
    <br>
    Created using <a href="http://sphinx-doc.org/">Sphinx</a> 7.2.5 with <a href="https://github.com/romnn/sphinx_press_theme">Press Theme</a>.
</div>
            </div>
          </div>
      </page>
    </div>
    
    
  </body>
</html>